# 项目交接文档 (Handover Documentation)

## 1. 项目概况
本项目是一个基于中国象棋规则，融合 Roguelike 卡牌构建元素的在线对战游戏。玩家在传统象棋的回合制对弈中，通过抽取和使用功能各异的锦囊卡牌（召唤、装备、行动、规则等）来改变战局。项目包含完整的用户注册/登录系统、大厅/房间管理机制以及核心游戏引擎。

---

## 2. 可用资源

### 2.1 服务器信息
- **IP 地址**: `120.26.212.80`
- **SSH 端口**: `22`
- **Web 服务端口**: `3333`
- **游戏访问地址**: [http://120.26.212.80:3333](http://120.26.212.80:3333)

### 2.2 账号凭证 (SSH & 管理)
- **用户名**: `root`
- **密码**: `Game2026`

### 2.3 后端管理
后端服务使用 `pm2` 进行进程管理。
- **查看状态**: `pm2 list`
- **查看日志**: `pm2 logs game`
- **重启服务**: `pm2 restart game`
- **项目部署路径**: `/var/www/game`

---

## 3. 游戏玩法与规则

### 基础规则
- **获胜条件**: 吃掉对方的“将/帅”。
- **基本走发**: 遵循中国象棋标准规则。
- **思考时间**: 每方10分钟包干。

### 卡牌系统
- **锦囊（手牌）**: 玩家每回合开始时进行“选牌”（3选1）。
- **稀有度**: 分为白银 (40%)、黄金 (40%)、彩色 (Prismatic, 20%)。若一方选了某种稀有度，下一回合对手选牌时出现的卡牌稀有度将与之一致（同步机制）。
- **主要卡牌类型**:
  - **速攻**: 仅在当前回合生效的卡牌。
  - **召唤 (Summon)**: 在棋盘放置中立或己方单位（如路障、援军）。
  - **装备 (Equip)**: 强化棋子（如洋装-兵升车、自爆装置）。
  - **行动 (Action)**: 发动后会跳过当前回合棋子行动阶段的卡牌。
  - **永续 (Rule)**: 改变全局规则（如无限移动距离、禁止过河）,场上最多存在一张,后发的永续卡会覆盖先发的永续卡。
  - **陷阱 **: 使用后不会提醒对手,在特定的条件下执行效果。

---

## 4. 项目结构与文件说明

| 目录/文件 | 说明 |
| :--- | :--- |
| **`src/`** | **前端源码 (React + Vite)** |
| `src/game/engine.js` | **核心引擎**：处理移动验证、卡牌效果解析、回合流转、状态管理。 |
| `src/game/cards.js` | 卡牌生成与随机逻辑（含 Seeded RNG 同步）。 |
| `src/game/cardDefs.js` | 33种卡牌的属性定义（ID、名称、效果描述）。 |
| `src/components/` | UI 组件 (GameArena, Board, Card, Lobby 等)。 |
| **`server/`** | **后端源码 (Node.js + Express + Socket.IO)** |
| `server/index.js` | 入口文件，HTTP 服务启动。 |
| `server/socket.js` | Socket.IO 事件处理 (房间管理、游戏同步)。 |
| `server/managers/` | 业务逻辑层 (RoomManager)。 |
| **`scripts/`** | **自动化脚本** |
| `scripts/auto-deploy.js` | 一键部署脚本 (打包 -> 上传 -> 重启)。 |
| `scripts/test_engine_rules.js` | 游戏规则验证脚本。 |
| `config/` | 数据库配置文件。 |

**主要依赖**:
- **前端**: `react`, `socket.io-client`, `vite`
- **后端**: `express`, `socket.io`, `sequelize` (ORM), `mysql2`, `bcrypt` (加密), `jsonwebtoken` (Auth)

---

## 5. 任务完成情况

### ✅ 已完成任务 (Completed)
1.  **基础设施**:
    - 数据库设计与集成 (MySQL/Sequelize)。
    - 用户认证系统 (JWT, 登录/注册/游客)。
    - 房间管理系统 (创建/加入/公开列表/准备逻辑)。
    - 自动化部署流程 (Git Hook -> Script -> Server)。
2.  **核心游戏性**:
    - 游戏引擎重写 (Engine.js)，支持复杂状态 (Buffs, Traps, Global Rules)。
    - **33种新卡牌**完整实现 (含代码逻辑与定义)。
    - 稀有度同步机制 & 确定性随机数 (Seeded RNG) 防止联机不同步。
3.  **UI/UX**:
    - 全新卡牌视觉样式 (彩色流光特效)。
    - 游戏内通知系统 & 卡牌堆叠显示。
    - 房间大厅与等待室 UI。

### ⏳ 待完成 / 需修复任务 (Pending / In Progress)
*以下为用户最新反馈中指出需要修复或新增的功能：*

1.  **Bug 修复**:
    - [ ] **选牌阶段卡死**: 修复点击 Draft 卡牌无反应的问题 (DraftModal/Engine 交互)。
2.  **规则补充**:
    - [ ] **手牌上限逻辑**:
        - 上限 3 张。
        - 手牌满时，回合开始直接**跳过**选牌阶段。
        - 游戏过程中获得卡牌如果手牌已满，直接丢弃且不提示。
    - [ ] **炮吃子自毁**: 若炮吃子时使用了“召唤物”作为炮架，吃子后炮自身一同消灭。
    - [ ] **召唤物上限**: 场上最多存在 2 个召唤物。生成第 3 个时，最早生成的那个自动消灭 (FIFO)。
3.  **UI 完善**:
    - [ ] **路径残留**: 增加对手上一步移动的起始/终点高亮提示。
    - [ ] **游戏结束优化**: 确保胜利/失败界面正确弹出并可返回大厅。
    - [ ] **规则文案**: 更新设置界面中的规则说明，包含上述新规则。

---

## 6. 其他要求与说明
交接后建议优先处理 **第5节中的“待完成任务”**，以确保游戏核心流程闭环且符合设计初衷。部署脚本均已通过验证，后续更新代码后运行 `npm run deploy` 即可发布到服务器。
